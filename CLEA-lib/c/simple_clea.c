#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include "clea.h"

uint8_t SK_L[SK_L_SIZE] = {17, 50, 178, 117, 142, 93, 11, 228, 16, 198, 218, 172, 28, 203, 30, 149, 105, 157, 195, 247, 12, 226, 62, 13, 255, 126, 84, 96, 87, 163, 80, 97, 213, 211, 66, 20, 248, 127, 9, 64, 84, 127, 135, 165, 127, 171, 14, 78, 34, 229, 223, 249, 156, 59, 123, 51, 153, 17, 250, 106};
uint8_t PK_SA[PUBLIC_KEY_SIZE] = {0xbc, 0x05, 0x51, 0x56, 0x7e, 0xcc, 0x32, 0x77, 0x99, 0x8f, 0x4b, 0xa9, 0xaf, 0x0c, 0xa6, 0x35, 0xdd, 0xe3, 0x6b, 0xd2, 0x01, 0x55, 0x95, 0xbc, 0xab, 0xa2, 0x74, 0x0c, 0xcd, 0xc0, 0x6e, 0x7f, 0x78, 0x0d, 0x9e, 0xd2, 0xf4, 0x7f, 0xbc, 0xc5, 0xb4, 0xb4, 0x65, 0x49, 0x73, 0x3e, 0x2f, 0x9f, 0xb0, 0xf5, 0xc5, 0x86, 0x7a, 0x08, 0xec, 0xf6, 0x45, 0x16, 0xf9, 0x8d, 0x4c, 0x8a, 0x7e, 0xd5};
uint8_t PK_MCTA[PUBLIC_KEY_SIZE] = {0xbc, 0x05, 0x51, 0x56, 0x7e, 0xcc, 0x32, 0x77, 0x99, 0x8f, 0x4b, 0xa9, 0xaf, 0x0c, 0xa6, 0x35, 0xdd, 0xe3, 0x6b, 0xd2, 0x01, 0x55, 0x95, 0xbc, 0xab, 0xa2, 0x74, 0x0c, 0xcd, 0xc0, 0x6e, 0x7f, 0x78, 0x0d, 0x9e, 0xd2, 0xf4, 0x7f, 0xbc, 0xc5, 0xb4, 0xb4, 0x65, 0x49, 0x73, 0x3e, 0x2f, 0x9f, 0xb0, 0xf5, 0xc5, 0x86, 0x7a, 0x08, 0xec, 0xf6, 0x45, 0x16, 0xf9, 0x8d, 0x4c, 0x8a, 0x7e, 0xd5};

clea_conf_t clea_conf = 
{
    .staff                = 0,
    .locContactMsgPresent = 1,
    .CRIexp               = 10, // ~ 17min renewal interval
    .venueType            = 10,
    .venueCategory1       = 0,
    .venueCategory2       = 0,
    .countryCode          = 250, // France numeric code as defined in ISO3166-1
    .periodDuration       = 3,   // 3 hours
	.locationPhone        = {0x33, 0x80, 0x01, 0x30, 0x00, 0x0F, 0xFF, 0xFF}, // +33 800 130 000
    .locationRegion       = 11,
	.locationPin          = {0xDE, 0xAD, 0xBE} // "DEADBE"
};

uint8_t LSP_base64[LSP_BASE64_SIZE];

void print_qrcode()
{
    for(uint8_t i = 0; i < sizeof(LSP_base64); i++)
    {
        printf("%c", LSP_base64[i]);
    }
    printf("\n");
}

#define CHECK(expr) {uint32_t r; if((r = (expr))) {printf("Error: %d\n", r); exit(r);}}

int main(void)
{
    clea_init();
   
    for(uint8_t i = 0; i < 3; i++)
    {
        CHECK(clea_start_new_period(NULL, NULL, NULL));
        print_qrcode();

        for(uint8_t j = 0; j < 3; j++)
        {
            sleep(5);
            CHECK(clea_renew_qrcode(NULL, NULL));
            print_qrcode();
        }
    }

    return 0;
}